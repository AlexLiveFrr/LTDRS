<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex Transport | Gestion de Route</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <nav class="top-nav">
        <div class="nav-container">
            <div class="brand">
                <span class="logo">üöö</span>
                <span class="brand-name">LTDRS</span>
            </div>
        </div>
    </nav>

    <main class="main-content">
        
        <section id="auth-container" class="card" style="max-width: 500px; margin: 20px auto;">
            <div class="card-header">
                <span class="card-icon">üîë</span>
                <h2>Connexion Chauffeur</h2>
            </div>
            <div class="card-body">
                <div id="auth-form">
                    <input type="email" id="auth-email" placeholder="Email" class="mb-10" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                    <input type="password" id="auth-password" placeholder="Mot de passe" class="mb-10" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                    <button type="button" onclick="loginUser()" class="btn btn-primary" style="width: 100%;">Se connecter</button>
                </div>
                <div id="user-logged-in" style="display: none;">
                    <p>Bienvenue, <span id="user-display-name" style="font-weight: bold; color: #f97316;"></span> !</p>
                    <button type="button" onclick="logoutUser()" class="btn btn-secondary mt-10">Se d√©connecter</button>
                </div>
            </div>
        </section>

        <header class="content-header">
            <div>
                <h1>Feuille de Route</h1>
            </div>
        </header>

        <form id="feuilleRoute" class="dashboard-grid">

            <section class="card">
                <div class="card-header">
                    <span class="card-icon">üë§</span>
                    <h2>Informations G√©n√©rales</h2>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="idFeuille">N¬∞ de Feuille</label>
                            <input type="text" id="idFeuille" readonly class="input-readonly">
                        </div>
                        <div class="form-group">
                            <label for="serveurRoute">Serveur de Route</label>
                            <select id="serveurRoute" required>
                                <option value="">Choisir...</option>
                                <option value="Entreprise">Serveur Entreprise</option>
                                <option value="Solo">Solo</option>
                                <option value="Serve1">Simulation 1</option>
                                <option value="Serve2">Simulation 2</option>
                                <option value="Serve3">Arcade</option>
                                <option value="ProMods">ProMods</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="nomChauffeur">Pr√©nom du Chauffeur</label>
                        <input type="text" id="nomChauffeur" placeholder="Ex: Jean" required>
                    </div>
                </div>
            </section>

            <section class="card">
                <div class="card-header">
                    <span class="card-icon">üöõ</span>
                    <h2>D√©tails du Camion</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="typeVehicule">Type de configuration</label>
                        <select id="typeVehicule" required>
                            <option value="semi">Semi-remorque</option>
                            <option value="camion">Camion remorque</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="marqueCamion">Marque</label>
                            <select id="marqueCamion" required></select>
                        </div>
                        <div class="form-group">
                            <label for="modeleCamion">Mod√®le</label>
                            <select id="modeleCamion" required></select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="kilometrageDepart">KM D√©part</label>
                            <input type="number" id="kilometrageDepart" required>
                        </div>
                        <div class="form-group">
                            <label for="kilometrageArrivee">KM Arriv√©e</label>
                            <input type="number" id="kilometrageArrivee" required>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card wide">
                <div class="card-header">
                    <span class="card-icon">üìç</span>
                    <h2>Itin√©raire & Marchandise</h2>
                </div>
                <div class="card-body grid-3-cols">
                    <div class="location-box">
                        <h3>D√©part</h3>
                        <select id="pays-depart" class="mb-10"></select>
                        <select id="ville-depart" class="mb-10"></select>
                        <input type="datetime-local" id="dateDepart" required>
                        <input type="text" id="lieuDepart" placeholder="D√©p√¥t de d√©part" class="mt-10">
                    </div>

                    <div class="location-box">
                        <h3>Arriv√©e</h3>
                        <select id="pays-arrivee" class="mb-10"></select>
                        <select id="ville-arrivee" class="mb-10"></select>
                        <input type="datetime-local" id="dateArriveeEstimee" required>
                        <input type="text" id="lieuArrivee" placeholder="D√©p√¥t d'arriv√©e" class="mt-10">
                    </div>

                    <div class="cargo-box">
                        <h3>Cargaison</h3>
                        <label>Nature</label>
                        <input type="text" id="natureMarchandise" placeholder="Ex: Bobines d'acier" required>
                        <label>Poids (Tonnes)</label>
                        <input type="number" id="poids" step="0.01" required>
                        <label>Ferry / Train</label>
                        <select id="ferry">
                            <option value="0">Aucun</option>
                            <option value="13">Calais - Dover</option>
                            <option value="14">Le Shuttle (Folkestone)</option>
                        </select>
                    </div>
                </div>
            </section>

            <section class="card checklist-card">
                <div class="card-header">
                    <span class="card-icon">üìã</span>
                    <h2>Checklist de D√©part</h2>
                </div>
                <div class="card-body">
                    <div class="checklist-grid">
                        <label class="check-tile">
                            <input type="checkbox" id="check-attelage">
                            <div class="tile-content">
                                <span class="tile-icon">üîó</span>
                                <span class="tile-text">Attelage</span>
                            </div>
                        </label>
                        <label class="check-tile">
                            <input type="checkbox" id="check-pneus">
                            <div class="tile-content">
                                <span class="tile-icon">üõû</span>
                                <span class="tile-text">Pneus OK</span>
                            </div>
                        </label>
                        <label class="check-tile">
                            <input type="checkbox" id="check-docs">
                            <div class="tile-content">
                                <span class="tile-icon">üìÑ</span>
                                <span class="tile-text">Documents</span>
                            </div>
                        </label>
                        <label class="check-tile">
                            <input type="checkbox" id="check-lumieres">
                            <div class="tile-content">
                                <span class="tile-icon">üí°</span>
                                <span class="tile-text">Feux</span>
                            </div>
                        </label>
                    </div>
                </div>
            </section>

            <section class="card">
                <div class="card-header">
                    <span class="card-icon">‚ö†Ô∏è</span>
                    <h2>Incidents & √âtat</h2>
                </div>
                <div class="card-body">
                    <div class="repair-status-container">
                        <label>√âtat du v√©hicule apr√®s trajet :</label>
                        <div class="status-toggle">
                            <button type="button" id="status-ok" class="status-button active" data-status="non">‚úÖ OK</button>
                            <button type="button" id="status-repair" class="status-button" data-status="oui">üîß R√©paration</button>
                        </div>
                        <input type="hidden" id="reparationNecessaire" value="non">
                    </div>

                    <div id="menu-incident-details" style="display: none; margin-top: 20px;">
                        <div class="form-group">
                            <label for="pays-incident">Lieu de l'incident (Pays)</label>
                            <select id="pays-incident">
                                <option value="">S√©lectionnez un pays</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="ville-incident">Ville de l'incident</label>
                            <select id="ville-incident">
                                <option value="">S√©lectionnez d'abord un pays</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="type-infraction">Type d'infraction / Probl√®me</label>
                            <select id="type-infraction">
                                <option value="">S√©lectionnez le type d'infraction</option>
                                <option value="feu_rouge">Feux rouge grill√©</option>
                                <option value="exces_vitesse">Exc√®s de vitesse</option>
                                <option value="absence_eclairage">Absence d'√©clairage</option>
                                <option value="accident">Accident</option>
                                <option value="contresens">Contresens</option>
                                <option value="panne_essence">Panne d'essence</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="pourcentage-degats">D√©g√¢ts subis : <span id="degats-display" style="font-weight: bold;">0%</span></label>
                            <input type="range" id="pourcentage-degats" min="0" max="100" value="0" style="width: 100%;">
                        </div>

                        <div class="form-group">
                            <label for="commentaire-incident">Commentaire sur l'incident</label>
                            <textarea id="commentaire-incident" rows="3" placeholder="Pr√©cisez les circonstances..."></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card">
                <div class="card-header">
                    <span class="card-icon">üìù</span>
                    <h2>Notes de route</h2>
                </div>
                <div class="card-body">
                    <textarea id="observations" rows="5" placeholder="Comment s'est pass√© votre trajet ?"></textarea>
                </div>
            </section>

            <section class="card">
                <div class="card-header">
                    <span class="card-icon">üí∂</span>
                    <h2>Frais de Route & Statistiques</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label>Frais de Repas / Repos (‚Ç¨)</label>
                        <input type="number" id="frais-repas" min="0" step="0.01" value="0">
                    </div>
                    <div class="form-group">
                        <label>Amendes (‚Ç¨)</label>
                        <input type="number" id="frais-amendes" min="0" step="0.01" value="0">
                    </div>

                    <div class="stats-container mt-20" style="background: rgba(0,0,0,0.1); padding: 15px; border-radius: 8px;">
                        <p>Consommation Moyenne : <span id="stat-conso" style="font-weight:bold;">0</span> L/100km</p>
                        <p>Temps de Conduite : <span id="stat-temps" style="font-weight:bold;">0h 00m</span></p>
                    </div>
                </div>
            </section>

            <section class="card">
                <div class="card-header">
                   <span class="card-icon">üì∏</span>
                   <h2>Photo de l'incident / √âtat</h2>
                </div>
                <div class="card-body">
                    <input type="file" id="photo-incident" accept="image/*" class="form-control">
                </div>
            </section>

            <section class="card">
                <div class="card-header">
                    <span class="card-icon">‚úçÔ∏è</span>
                    <h2>Signature du Chauffeur</h2>
                </div>
                <div class="card-body">
                    <div class="signature-container">
                        <canvas id="signature-pad"></canvas>
                    </div>
                    <div class="signature-actions">
                        <button type="button" id="clear-signature">Effacer la signature</button>
                    </div>
                </div>
            </section>

        </form>

        <footer class="form-footer no-print">
            <div class="footer-container">
                <div class="footer-actions">
                    <button type="reset" form="feuilleRoute" class="btn btn-secondary">
                        üîÑ R√©initialiser
                    </button>
                    <button type="button" id="downloadBtn" onclick="downloadFeuille()" class="btn btn-primary">
                        üì• T√©l√©charger le PDF
                    </button>
                </div>
            </div>
        </footer>
    </main>

    <script src="./js/supabase-handler.js"></script>
    <script src="./js/auth.js"></script>
    <script src="./js/script.js"></script>
    <script src="./js/ville_pays.js"></script>
    <script src="./js/theme_jour_nuit.js"></script>
    <script src="./js/id_unique.js"></script>
    <script src="./js/reparation.js"></script>
    <script src="./js/incident.js"></script>
    <script src="./js/plein_essence.js"></script>
    <script src="./js/download_feuille.js"></script>
    <script src="./js/transport_details.js"></script>
    <script src="./js/marque_model.js"></script>
    <script src="./js/historique.js"></script>
    <script src="./js/auto_complete.js"></script>
    <script src="./js/truckersmp-auto-fill.js"></script>
    <script src="./js/truckersmp-players.js"></script>
    <script src="./js/stats_signature.js"></script>
</body>

</html>